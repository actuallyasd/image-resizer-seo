<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SEO + Analytics Report – bestimageresizer.com</title>

  <style>
    :root{
      --bg:#121212; --panel:#1c1c1e; --panel-2:#222225;
      --ink:#f5f5f7; --ink-2:#cfcfd3; --muted:#9c9ca3;
      --blue:#0a84ff; --green:#30d158; --amber:#ffd60a; --red:#ff453a; --purple:#7a7aff; --orange:#ff9f0a;
      --grid:#2c2c2e; --shadow:0 8px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:20px; font-family:-apple-system,BlinkMacSystemFont,"San Francisco",Arial,sans-serif;
      background:var(--bg); color:var(--ink);
    }
    body::after{
      content:""; position:fixed; inset:0; pointer-events:none;
      background-image:radial-gradient(rgba(255,255,255,.025) 1px, transparent 1px);
      background-size:3px 3px;
    }

    h1{ text-align:center; margin:0 0 28px; letter-spacing:.2px; }

    /* MAIN TABS */
    .tabs{ display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:20px; }
    .tab{
      padding:10px 18px; border-radius:12px; background:#1e1e1e; color:var(--ink);
      cursor:pointer; transition:.25s; user-select:none;
    }
    .tab:hover{ transform:translateY(-1px); }
    .tab.active{ background:var(--blue); color:#fff; box-shadow:0 6px 18px rgba(10,132,255,.35); }

    .content{ display:none; background:var(--panel); border-radius:16px; padding:24px; box-shadow:var(--shadow); animation:fade .35s ease; }
    .content.active{ display:block; }
    @keyframes fade{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)} }

    /* SUBTABS */
    .subtabs{ display:flex; gap:8px; margin:10px 0 14px; flex-wrap:wrap; }
    .subtab{
      padding:6px 12px; border-radius:9px; background:#2c2c2e; color:var(--ink);
      cursor:pointer; transition:.2s; font-size: 14px;
    }
    .subtab:hover{ background: #3a3a3d; }
    .subtab.active{ background:var(--green); color:#fff; box-shadow:0 6px 14px rgba(48,209,88,.35); }
    
    .subcontent{ display:none; }
    .subcontent.active{ display:block; animation:fade .35s ease; }

    /* VERSION SWITCHER (For Analytics) */
    .version-switch {
      display:flex; justify-content:center; gap:4px; margin-bottom:20px; 
      background: #2c2c2e; padding:4px; border-radius:10px; width: fit-content; margin-left: auto; margin-right: auto;
    }
    .v-btn {
      padding: 6px 16px; border-radius: 8px; cursor: pointer; color: var(--muted); font-weight: 600; font-size: 13px; transition: .2s;
    }
    .v-btn.active {
      background: var(--panel); color: var(--ink); box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* IFRAMES */
    iframe{
      width:100%; min-height:520px; height:70vh;              
      border:none; border-radius:12px; background:#2c2c2e; margin:12px 0 22px; box-shadow:var(--shadow);
    }
    iframe.doc-iframe{ height:85vh !important; }
    @media (max-width: 900px){
      iframe{ height:65vh; }
      iframe.doc-iframe{ height:80vh !important; }
    }

    /* TILES */
    .tile-grid{ display:grid; gap:14px; grid-template-columns:repeat(2, minmax(220px, 1fr)); }
    @media (min-width:980px){ .tile-grid{ grid-template-columns:repeat(4, minmax(220px, 1fr)); } }
    .tile{
      background:var(--panel-2); border-radius:14px; padding:14px 16px; box-shadow:var(--shadow);
      display:flex; flex-direction:column; gap:6px; min-height:96px;
    }
    .tile .label{ color:var(--ink-2); font-size:13px; }
    .tile .value{ font-size:22px; font-weight:800; letter-spacing:.3px; }
    .tile .sub{ color:var(--muted); font-size:12px; }

    /* CHARTS */
    .chart-box{ background:var(--panel-2); border-radius:12px; padding:14px; box-shadow:var(--shadow); height:300px; display:flex; align-items:center; }
    .chart-box canvas{ width:100% !important; height:100% !important; }

    /* HELPERS */
    .impact-wrap{ background:var(--panel-2); padding:14px; border-radius:14px; }
    #seoChart{ width:100%; height:320px !important; }
    .gridish{ background:var(--grid); border-radius:12px; }

    .richtext { color: var(--ink-2); line-height:1.6; }
    .richtext h3{ color: var(--ink); margin: 18px 0 8px; }
    .richtext p{ margin: 0 0 14px; }
    .richtext ul { list-style: disc; padding-left: 1.2rem; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>

<body>
  <h1>SEO + Analytics Report – bestimageresizer.com</h1>

  <div class="tabs">
    <div class="tab active" data-tab="keywords">Keyword Research</div>
    <div class="tab" data-tab="competitors">Competitor Analysis</div>
    <div class="tab" data-tab="impact">Impact Analysis</div>
    <div class="tab" data-tab="technical">Technical SEO</div>
    <div class="tab" data-tab="analytics">Analytics</div>
    <div class="tab" data-tab="nextsteps">Next Steps</div>
  </div>

  <div id="technical" class="content">
    <h2>Technical SEO</h2>
    <ul id="technical-list"></ul>
  </div>

  <div id="keywords" class="content active">
    <h2>Keyword Research</h2>
    <div class="subtabs">
      <div class="subtab active" data-sub="transactional">Transactional</div>
      <div class="subtab" data-sub="informational">Informational</div>
      <div class="subtab" data-sub="navigational">Navigational</div>
      <div class="subtab" data-sub="commercial">Commercial</div>
    </div>

    <div id="transactional" class="subcontent active">
      <h3>Core function</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRmxxbbDjBgvoT3eaUlmK0od3fD1OCQvWETUnB4BReUZr_joyRd1hH4AR0NipwTO8buReLKIgnVDh50/pubhtml?gid=1764063307&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>User intent</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRmxxbbDjBgvoT3eaUlmK0od3fD1OCQvWETUnB4BReUZr_joyRd1hH4AR0NipwTO8buReLKIgnVDh50/pubhtml?gid=1096589268&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>Platform specific</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRmxxbbDjBgvoT3eaUlmK0od3fD1OCQvWETUnB4BReUZr_joyRd1hH4AR0NipwTO8buReLKIgnVDh50/pubhtml?gid=1070525027&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
    </div>

    <div id="informational" class="subcontent">
      <h3>Prepositions</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSqeNceKSuzCMCNskX1XSyTA-GFN3Xcx8ye2GqGZLMF00duVSdJcLyCccxq-fQwxyHIS9NJMN9z3inD/pubhtml?gid=689662762&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>Questions V1</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSqeNceKSuzCMCNskX1XSyTA-GFN3Xcx8ye2GqGZLMF00duVSdJcLyCccxq-fQwxyHIS9NJMN9z3inD/pubhtml?gid=1707919888&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>Questions V2</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSqeNceKSuzCMCNskX1XSyTA-GFN3Xcx8ye2GqGZLMF00duVSdJcLyCccxq-fQwxyHIS9NJMN9z3inD/pubhtml?gid=985068758&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
    </div>

    <div id="navigational" class="subcontent">
      <h3>Navigational big brands</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSYVLKWv9BOHHqE-Lj4izr5ne3lzL58ZT8DFZl5P7ap4HeHmCFxkuZ2H4mfTkHOmrzCyWXg0aj8TU1d/pubhtml?gid=313868502&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>Navigational medium competition</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSYVLKWv9BOHHqE-Lj4izr5ne3lzL58ZT8DFZl5P7ap4HeHmCFxkuZ2H4mfTkHOmrzCyWXg0aj8TU1d/pubhtml?gid=775491972&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
    </div>

    <div id="commercial" class="subcontent">
      <h3>Commercial Comparison</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRmWxvrBMzEzrBQKc6vCGwfEZvUdRm9JWVxex4xqzVt5kqI_vab5Egoqao3BgUsZNKWrvYyCRvtQKQE/pubhtml?widget=true&amp;headers=false"></iframe>
    </div>
  </div>

  <div id="impact" class="content">
    <h2>SEO Impact Analysis</h2>
    <div class="impact-wrap gridish">
      <canvas id="seoChart"></canvas>
    </div>
  </div>

  <div id="competitors" class="content">
    <h2>Competitor Analysis</h2>
    <div class="subtabs">
      <div class="subtab active" data-sub="comp-stats">Competitor Stats</div>
      <div class="subtab" data-sub="comp-gap">Keyword Gap (Birme vs. Others)</div>
      <div class="subtab" data-sub="comp-insights">SEO Insights</div>
    </div>

    <div id="comp-stats" class="subcontent active">
      <section class="comp-card">
        <div class="chart-box"><canvas id="birme-traffic"></canvas></div>
      </section>
    </div>

    <div id="comp-gap" class="subcontent">
      <h3>Keyword Gap: Birme vs. other competitors</h3>
      <div class="gridish" style="overflow:auto; border-radius:12px; padding:8px;">
        <table id="gap-table" style="width:100%; border-collapse:collapse; color:#eaeaea; font-size:14px;">
          <thead id="gap-thead"></thead>
          <tbody id="gap-tbody"></tbody>
        </table>
      </div>
    </div>

    <div id="comp-insights" class="subcontent">
      <iframe class="doc-iframe" src="https://docs.google.com/document/d/e/2PACX-1vQLEn_2HV2T3-O7Xidzca6kmNh-XdQbt1oiS-cNM1WmeIu1niWpZRUr7gLRVwa0MG7H7XwayI2X58n6/pub?embedded=true"></iframe>
    </div>
  </div>

  <div id="analytics" class="content">
    
    <div class="version-switch">
      <div class="v-btn active" onclick="switchAnaVersion('1.0')">Analytics 1.0</div>
      <div class="v-btn" onclick="switchAnaVersion('2.0')">Analytics 2.0</div>
    </div>

    <div id="ana-v1" class="ana-version-wrapper" style="display:block;">
      <h2>Analytics 1.0 (Historical)</h2>
      <div class="subtabs">
        <div class="subtab active" data-sub="ana-overview">Overview</div>
        <div class="subtab" data-sub="ana-retention">Retention</div>
        <div class="subtab" data-sub="ana-campaigns">Campaigns</div>
        <div class="subtab" data-sub="ana-stickiness">Stickiness</div>
        <div class="subtab" data-sub="ana-funnel">Funnel</div>
        <div class="subtab" data-sub="ana-reports">Reports</div>
        <div class="subtab" data-sub="ana-insights">Insights</div>
      </div>

      <div id="ana-overview" class="subcontent active">
        <div class="tile-grid" id="ov-tiles"></div>
        <div class="chart-box" style="margin-top:16px;"><canvas id="ov-chart"></canvas></div>
        <h3 style="margin-top:22px;">Events: Event name (attached)</h3>
        <div id="ov-attachments"></div>
      </div>

      <div id="ana-retention" class="subcontent">
        <h3 style="margin-top:12px;">Overall Retention (Week 0–6)</h3>
        <div class="gridish" style="overflow:auto; border-radius:12px; padding:8px;">
          <table id="ret-table" style="width:100%; border-collapse:collapse; color:#eaeaea; font-size:14px;"></table>
        </div>
        <h3 style="margin-top:22px;">Overall Retention (attached report)</h3>
        <div id="ret-attachments"></div>
      </div>

      <div id="ana-campaigns" class="subcontent">
        <div id="camp-tiles" class="tile-grid"></div>
        <h3 style="margin-top:12px;">Campaign Retention (Week 0–6)</h3>
        <div class="gridish" style="overflow:auto; border-radius:12px; padding:8px;">
          <table id="camp-ret-table" style="width:100%; border-collapse:collapse; color:#eaeaea; font-size:14px;"></table>
        </div>
        <h3 style="margin-top:22px;">Campaign Reports (attached)</h3>
        <div id="camp-attachments"></div>
      </div>

      <div id="ana-stickiness" class="subcontent">
        <div class="tile-grid" id="stk-tiles"></div>
        <h3 style="margin-top:22px;">User Stickiness (attached)</h3>
        <div id="stk-attachments"></div>
      </div>

      <div id="ana-funnel" class="subcontent">
        <h3>User Funnel (attached)</h3>
        <div id="fun-attachments"></div>
      </div>

      <div id="ana-reports" class="subcontent">
        <h3>All Attached Reports</h3>
        <div id="rep-attachments"></div>
      </div>

      <div id="ana-insights" class="subcontent">
        <div class="richtext">
          <h3>Funnel (overall, Wix → App)</h3>
          <ul>
            <li><strong>CTA click-through (Wix → App):</strong> ~81.8% (5,826 / 7,127) — very strong.</li>
            <li><strong>Redirect → Login:</strong> ~83.3% (4,851 / 5,826) — low friction after the redirect.</li>
            <li><strong>Login → First resize:</strong> ~64.1% (3,111 / 4,851) — biggest remaining drop.</li>
          </ul>
          <h3>Quick wins</h3>
          <ol>
            <li>Fix Redirect → Login for campaign cohorts.</li>
            <li>Newsletter campaigns to logged-in users.</li>
            <li>Post-session nudge on download.</li>
          </ol>
        </div>
      </div>
    </div>
    <div id="ana-v2" class="ana-version-wrapper" style="display:none;">
      <h2>Analytics 2.0 (New)</h2>

      <div class="subtabs">
        <div class="subtab active" data-sub="v2-traffic">Traffic Acquisition</div>
        <div class="subtab" data-sub="v2-events">Events</div>
        <div class="subtab" data-sub="v2-retention">Retention</div>
        <div class="subtab" data-sub="v2-reports">Reports</div>
        <div class="subtab" data-sub="v2-insights">Insights</div>
      </div>

      <div id="v2-traffic" class="subcontent active">
        <div class="tile-grid">
           <div class="tile">
             <div class="label">Top Source</div>
             <div class="value">IndieHackers</div>
             <div class="sub">11 sessions</div>
           </div>
           <div class="tile">
             <div class="label">Runner Up</div>
             <div class="value">StartupTile</div>
             <div class="sub">7 sessions</div>
           </div>
           <div class="tile">
             <div class="label">Engagement (IndieHackers)</div>
             <div class="value">54.5%</div>
             <div class="sub">Engagement Rate</div>
           </div>
           <div class="tile">
            <div class="label">New Sessions</div>
            <div class="value">26</div>
            <div class="sub">Total for period</div>
          </div>
        </div>

        <div class="chart-box" style="margin-top:16px;">
          <canvas id="v2-traffic-chart"></canvas>
        </div>

        <h3>Detailed Report</h3>
        <iframe class="doc-iframe" src="assets/Traffic acuisition overview.pdf"></iframe>
      </div>

      <div id="v2-events" class="subcontent">
        <div class="tile-grid">
          <div class="tile">
            <div class="label">Image Uploads</div>
            <div class="value">143</div>
            <div class="sub">High intent action</div>
          </div>
          <div class="tile">
            <div class="label">Zip Downloads</div>
            <div class="value">135</div>
            <div class="sub">14.3% of total events</div>
          </div>
          <div class="tile">
            <div class="label">Images Exported</div>
            <div class="value">73</div>
            <div class="sub">Successful conversions</div>
          </div>
          <div class="tile">
            <div class="label">Page Views</div>
            <div class="value">250</div>
            <div class="sub">Across all users</div>
          </div>
        </div>

        <div class="chart-box" style="margin-top:16px;">
          <canvas id="v2-events-chart"></canvas>
        </div>

        <h3>Detailed Report</h3>
        <iframe class="doc-iframe" src="assets/Events.pdf"></iframe>
      </div>

      <div id="v2-retention" class="subcontent">
        <div class="tile-grid">
          <div class="tile">
            <div class="label">New Users</div>
            <div class="value">197</div>
            <div class="sub">Last 42 days</div>
          </div>
          <div class="tile">
            <div class="label">DAU / MAU</div>
            <div class="value">36.8%</div>
            <div class="sub">Stickiness</div>
          </div>
          <div class="tile">
            <div class="label">WAU / MAU</div>
            <div class="value">78.5%</div>
            <div class="sub">Strong weekly usage</div>
          </div>
          <div class="tile">
            <div class="label">Returning Users</div>
            <div class="value">38</div>
            <div class="sub">Core user base</div>
          </div>
        </div>

        <div class="chart-box" style="margin-top:16px;">
          <canvas id="v2-retention-chart"></canvas>
        </div>

        <h3>Detailed Report</h3>
        <iframe class="doc-iframe" src="assets/Retention_overview.pdf"></iframe>
      </div>

      <div id="v2-reports" class="subcontent">
        <h3>Traffic Acquisition Overview</h3>
        <iframe class="doc-iframe" src="assets/Traffic acuisition overview.pdf" style="margin-bottom:30px;"></iframe>
        <hr style="border:1px solid #333; margin:30px 0;">
        <h3>Events Data</h3>
        <iframe class="doc-iframe" src="assets/Events.pdf" style="margin-bottom:30px;"></iframe>
        <hr style="border:1px solid #333; margin:30px 0;">
        <h3>Retention Overview</h3>
        <iframe class="doc-iframe" src="assets/Retention_overview.pdf"></iframe>
      </div>

      <div id="v2-insights" class="subcontent">
        <div class="richtext">
          <p><em>Pending analysis...</em></p>
        </div>
      </div>

    </div>
    </div>

  <div id="nextsteps" class="content">
    <h2>Next Steps</h2>
    <div id="nextsteps-content">
      <ul style="list-style:disc; padding-left:1.25rem; color:var(--ink-2); line-height:1.6;">
        <li><strong style="color:var(--ink)">Blog:</strong> Keep cadence focused on informational & commercial queries.</li>
        <li><strong style="color:var(--ink)">Dynamic CMS Pages:</strong> Platform + industry variants.</li>
        <li><strong style="color:var(--ink)">Campaign tuning:</strong> Use campaign retention deltas to reallocate spend.</li>
      </ul>
    </div>
  </div>

  <script>
    // Deep clone helper
    function deepClone(obj){
      try { return typeof structuredClone==='function' ? structuredClone(obj) : JSON.parse(JSON.stringify(obj)); }
      catch(e){ return JSON.parse(JSON.stringify(obj)); }
    }

    /* Chart settings */
    Chart.defaults.color = '#d8d8de';
    Chart.defaults.borderColor = 'rgba(255,255,255,.08)';

    function makeChart(id, type, labels, data, colors, opts={}){
      const el = document.getElementById(id); if(!el) return;
      // prevent reusing canvas if already exists (destroy old chart instance if needed)
      // simple hack: clone the node to clear chartjs instance binding
      
      const options = {
        responsive:true, maintainAspectRatio:false,
        plugins:{ legend:{ display:(opts.legend!==undefined)?opts.legend:(type!=='bar') }, tooltip:{enabled:true} },
        scales:{}
      };
      if(type!=='pie' && type!=='doughnut'){
        options.scales = { x:{grid:{color:'rgba(255,255,255,.06)'}}, y:{grid:{color:'rgba(255,255,255,.06)'}} };
      }
      new Chart(el.getContext('2d'),{
        type, data:{ labels, datasets:[{ label:opts.label||'', data, backgroundColor:colors, borderColor:colors, tension:.32, fill:(type==='line')?false:true, pointRadius:(type==='line')?3:0 }] }, options
      });
    }

    /* --- Existing V1 Logic --- */
    makeChart('seoChart','bar',['Meta Titles','Alt Text','Schema','Page Speed'],[8,7,9,6],['#0a84ff','#30d158','#ffd60a','#ff453a'],{legend:false});
    makeChart('birme-traffic','line',['Feb','Mar','Apr','May','Jun','Jul','Aug'],[13787,14607,13907,14553,13090,19484,15760],['#0a84ff'],{label:'Organic Traffic'});

    const GAP_CSV = 'assets/Birme%20keyword%20gap.csv';
    function renderGapTable(rows, limit=1000){
      const thead = document.getElementById('gap-thead');
      const tbody = document.getElementById('gap-tbody');
      if(!thead||!tbody||!rows||!rows.length) return;
      const cols = Object.keys(rows[0]);
      thead.innerHTML = '<tr>' + cols.map(c=>`<th style="text-align:left;padding:8px;border-bottom:1px solid rgba(255,255,255,.08)">${c}</th>`).join('') + '</tr>';
      tbody.innerHTML = rows.slice(0,limit).map(r=>(
        '<tr>'+cols.map(c=>`<td style="padding:8px;border-bottom:1px solid rgba(255,255,255,.06)">${r[c]??''}</td>`).join('')+'</tr>'
      )).join('');
    }
    function loadKeywordGap(){
      if(!document.getElementById('gap-table')) return;
      if(typeof Papa==='undefined'){ console.warn('PapaParse not loaded'); return; }
      Papa.parse(GAP_CSV,{download:true,header:true,skipEmptyLines:true,complete:(res)=>renderGapTable(res.data)});
    }

    /* --- V1 Analytics Loader (legacy) --- */
    const CURRENT_ANALYTICS_FILE = 'assets/analytics-config.json';
    const ANA_DEFAULT = {
      period: '', overview: { wix:{page_view:0, app_redirect:0}, app:{login:0, export_images:0} },
      campaigns: { global: { wix:{page_view:0, app_redirect:0}, app:{login:0, export_images:0}, retention_pct:[100,0,0,0,0,0,0] }, europe: { wix:{page_view:0, app_redirect:0}, app:{login:0, export_images:0}, retention_pct:[100,0,0,0,0,0,0] } },
      retention_overall_pct:[100,0,0,0,0,0,0], stickiness:{dau:0, wau:0, mau:0}, attachments:{ overview:[], retention:[], campaigns:[], stickiness:[], funnel:[], reports:[] }
    };
    let ANA = structuredClone(ANA_DEFAULT);
    function fmt(n){ return (n??0).toLocaleString(); }
    function pct(n){ return (n*100).toFixed(1)+'%'; }
    function pct100(n){ return (n).toFixed(1)+'%'; } 
    function ratio(num, den){ return (!den||!num)?0:(num/den); }
    function makeTile(label, value, sub=''){ return `<div class="tile"><div class="label">${label}</div><div class="value">${value}</div>${sub?`<div class="sub">${sub}</div>`:''}</div>`; }
    function renderIframes(mountId, paths=[]){
      const mount = document.getElementById(mountId); if(!mount) return;
      if(!paths || !paths.length){ mount.innerHTML = `<p class="richtext">No attachments.</p>`; return; }
      mount.innerHTML = paths.map(p=>{ const isPDF = /\.pdf(?:$|\?)/i.test(p); return `<iframe ${isPDF ? 'class="doc-iframe"' : ''} src="${p}"></iframe>`; }).join('');
    }

    async function loadANAV1(){
      try{
        const r = await fetch(CURRENT_ANALYTICS_FILE, {cache:'no-store'}); if(!r.ok) throw 0; ANA = await r.json();
      }catch(e){ ANA = structuredClone(ANA_DEFAULT); }
      // Render V1
      const o = ANA.overview || {};
      const pv = o.wix?.page_view||0, ar=o.wix?.app_redirect||0, lg=o.app?.login||0, rz=o.app?.export_images||0;
      document.getElementById('ov-tiles').innerHTML = [
        makeTile('CTA click (Wix→App)', pct(ratio(ar,pv)), `${fmt(ar)} / ${fmt(pv)}`),
        makeTile('Redirect→Login', pct(ratio(lg,ar)), `${fmt(lg)} / ${fmt(ar)}`),
        makeTile('Login→Resize', pct(ratio(rz,lg)), `${fmt(rz)} / ${fmt(lg)}`),
        makeTile('Page→Resize', pct(ratio(rz,pv)), `${fmt(rz)} / ${fmt(pv)}`)
      ].join('');
      makeChart('ov-chart','bar',['CTA','Redirect→Login','Login→Resize','Page→Resize'],[ratio(ar,pv)*100, ratio(lg,ar)*100, ratio(rz,lg)*100, ratio(rz,pv)*100],['#0a84ff','#30d158','#ffd60a','#7a7aff'],{legend:false});
      renderIframes('ov-attachments', ANA.attachments?.overview||[]);
      
      const arr = ANA.retention_overall_pct || [];
      document.getElementById('ret-table').innerHTML = `<thead><tr>${['W0','W1','W2','W3','W4','W5','W6'].map(h=>`<th style="text-align:left;padding:10px;border-bottom:1px solid rgba(255,255,255,.08)">${h}</th>`).join('')}</tr></thead><tbody><tr>${arr.map(v=>`<td style="padding:10px;border-bottom:1px solid rgba(255,255,255,.06)">${pct100(v)}</td>`).join('')}</tr></tbody>`;
      renderIframes('ret-attachments', ANA.attachments?.retention||[]);

      renderIframes('camp-attachments', ANA.attachments?.campaigns||[]);
      renderIframes('stk-attachments', ANA.attachments?.stickiness||[]);
      renderIframes('fun-attachments', ANA.attachments?.funnel||[]);
      renderIframes('rep-attachments', ANA.attachments?.reports||[]);
    }

    /* --- V2 Analytics Logic (New) --- */
    function initAnalyticsV2(){
      // Traffic Chart (Source)
      makeChart('v2-traffic-chart', 'bar', ['IndieHackers','StartupTile','Wix','Google Tag','Firebase'], [11,7,4,3,1], ['#ff9f0a','#30d158','#0a84ff','#muted','#muted'], {label:'Sessions by Source'});

      // Events Chart
      makeChart('v2-events-chart', 'bar', ['Page View','Session Start','Image Upload','Download Zip','Export Img'], [250,178,143,135,73], ['#7a7aff','#0a84ff','#30d158','#ffd60a','#ff453a'], {label:'Event Counts'});

      // Retention/Stickiness Chart
      makeChart('v2-retention-chart', 'line', ['16 Nov','23 Nov','30 Nov','07 Dec','14 Dec'], [20,15,18,22,65], ['#30d158'], {label:'Returning Users Trend'});
    }

    /* --- Switching Logic --- */
    function switchAnaVersion(ver){
      // Toggle Buttons
      document.querySelectorAll('.v-btn').forEach(b => {
        b.classList.remove('active');
        if(b.textContent.includes(ver)) b.classList.add('active');
      });
      // Toggle Containers
      document.querySelectorAll('.ana-version-wrapper').forEach(el => el.style.display = 'none');
      if(ver === '1.0') document.getElementById('ana-v1').style.display = 'block';
      if(ver === '2.0') {
        document.getElementById('ana-v2').style.display = 'block';
        // Trigger charts resize
        initAnalyticsV2();
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Main Tabs
      document.querySelectorAll('.tab').forEach(tab=>{
        tab.addEventListener('click',()=>{
          document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
          document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(tab.dataset.tab).classList.add('active');
          
          if(tab.dataset.tab==='analytics'){
            // Default to V1 on load, or V2 if you prefer
            loadANAV1();
          }
        });
      });

      // Subtabs (Generic Handler for both V1 and V2)
      document.querySelectorAll('.subtab').forEach(sub=>{
        sub.addEventListener('click',()=>{
          // Find the parent content wrapper (V1 or V2)
          const wrap = sub.closest('.ana-version-wrapper') || sub.closest('.content'); 
          if(!wrap) return;

          // Deactivate siblings in this specific wrapper
          wrap.querySelectorAll('.subtab').forEach(s=>s.classList.remove('active'));
          wrap.querySelectorAll('.subcontent').forEach(sc=>sc.classList.remove('active'));

          // Activate clicked
          sub.classList.add('active');
          const target = document.getElementById(sub.dataset.sub); 
          if(target) target.classList.add('active');

          if(sub.dataset.sub==='comp-gap') loadKeywordGap();
          if(sub.dataset.sub.startsWith('v2-')) initAnalyticsV2(); // Redraw V2 charts just in case
        });
      });
    });
  </script>
</body>
</html>


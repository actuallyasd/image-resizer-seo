<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SEO + Analytics Report – bestimageresizer.com</title>

  <style>
    :root{
      --bg:#121212; --panel:#1c1c1e; --panel-2:#222225;
      --ink:#f5f5f7; --ink-2:#cfcfd3; --muted:#9c9ca3;
      --blue:#0a84ff; --green:#30d158; --amber:#ffd60a; --red:#ff453a; --purple:#7a7aff;
      --grid:#2c2c2e; --shadow:0 8px 28px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:20px; font-family:-apple-system,BlinkMacSystemFont,"San Francisco",Arial,sans-serif;
      background:var(--bg); color:var(--ink);
    }
    body::after{
      content:""; position:fixed; inset:0; pointer-events:none;
      background-image:radial-gradient(rgba(255,255,255,.025) 1px, transparent 1px);
      background-size:3px 3px;
    }

    h1{ text-align:center; margin:0 0 28px; letter-spacing:.2px; }

    .tabs{ display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:20px; }
    .tab{
      padding:10px 18px; border-radius:12px; background:#1e1e1e; color:var(--ink);
      cursor:pointer; transition:.25s; user-select:none;
    }
    .tab:hover{ transform:translateY(-1px); }
    .tab.active{ background:var(--blue); color:#fff; box-shadow:0 6px 18px rgba(10,132,255,.35); }

    .content{ display:none; background:var(--panel); border-radius:16px; padding:24px; box-shadow:var(--shadow); animation:fade .35s ease; }
    .content.active{ display:block; }
    @keyframes fade{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)} }

    .subtabs{ display:flex; gap:8px; margin:10px 0 14px; flex-wrap:wrap; }
    .subtab{
      padding:6px 12px; border-radius:9px; background:#2c2c2e; color:var(--ink);
      cursor:pointer; transition:.2s;
    }
    .subtab.active{ background:var(--green); color:#fff; box-shadow:0 6px 14px rgba(48,209,88,.35); }
    .subcontent{ display:none; }
    .subcontent.active{ display:block; }

iframe{
  width:100%;
  min-height:520px;       
  height:70vh;             
  border:none;
  border-radius:12px;
  background:#2c2c2e;
  margin:12px 0 22px;
  box-shadow:var(--shadow);
}

/* PDFs / long docs get extra height */
iframe.doc-iframe{
  height:85vh !important;
}

@media (max-width: 900px){
  iframe{ height:65vh; }
  iframe.doc-iframe{ height:80vh !important; }
}

    .tile-grid{ display:grid; gap:14px; grid-template-columns:repeat(2, minmax(220px, 1fr)); }
    @media (min-width:980px){ .tile-grid{ grid-template-columns:repeat(4, minmax(220px, 1fr)); } }
    .tile{
      background:var(--panel-2); border-radius:14px; padding:14px 16px; box-shadow:var(--shadow);
      display:flex; flex-direction:column; gap:6px; min-height:96px;
    }
    .tile .label{ color:var(--ink-2); font-size:13px; }
    .tile .value{ font-size:22px; font-weight:800; letter-spacing:.3px; }
    .tile .sub{ color:var(--muted); font-size:12px; }

    .chart-box{ background:var(--panel-2); border-radius:12px; padding:14px; box-shadow:var(--shadow); height:300px; display:flex; align-items:center; }
    .chart-box canvas{ width:100% !important; height:100% !important; }

    .download-btn{ display:inline-flex; align-items:center; gap:8px; margin-top:14px; padding:10px 16px; background:var(--blue); color:#fff; border:0; border-radius:10px; font-weight:700; cursor:pointer; transition:.2s; }
    .download-btn:hover{ filter:brightness(.95); transform:translateY(-1px); }

    .impact-wrap{ background:var(--panel-2); padding:14px; border-radius:14px; }
    #seoChart{ width:100%; height:320px !important; }
    .gridish{ background:var(--grid); border-radius:12px; }

    .richtext { color: var(--ink-2); line-height:1.6; }
    .richtext h3{ color: var(--ink); margin: 18px 0 8px; }
    .richtext p{ margin: 0 0 14px; }
    .richtext a { color: var(--blue); text-decoration:none; }
    .richtext a:hover { text-decoration:underline; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>

<body>
  <h1>SEO + Analytics Report – bestimageresizer.com</h1>

  <div class="tabs">
    <div class="tab active" data-tab="keywords">Keyword Research</div>
    <div class="tab" data-tab="competitors">Competitor Analysis</div>
    <div class="tab" data-tab="impact">Impact Analysis</div>
    <div class="tab" data-tab="technical">Technical SEO</div>
    <div class="tab" data-tab="analytics">Analytics</div>
    <div class="tab" data-tab="nextsteps">Next Steps</div>
  </div>

  <!-- Technical -->
  <div id="technical" class="content">
    <h2>Technical SEO</h2>
    <ul id="technical-list"></ul>
  </div>

  <!-- Keyword Research -->
  <div id="keywords" class="content active">
    <h2>Keyword Research</h2>
    <div class="subtabs">
      <div class="subtab active" data-sub="transactional">Transactional</div>
      <div class="subtab" data-sub="informational">Informational</div>
      <div class="subtab" data-sub="navigational">Navigational</div>
      <div class="subtab" data-sub="commercial">Commercial</div>
    </div>

    <div id="transactional" class="subcontent active">
      <h3>Core function</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRmxxbbDjBgvoT3eaUlmK0od3fD1OCQvWETUnB4BReUZr_joyRd1hH4AR0NipwTO8buReLKIgnVDh50/pubhtml?gid=1764063307&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>User intent</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRmxxbbDjBgvoT3eaUlmK0od3fD1OCQvWETUnB4BReUZr_joyRd1hH4AR0NipwTO8buReLKIgnVDh50/pubhtml?gid=1096589268&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>Platform specific</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRmxxbbDjBgvoT3eaUlmK0od3fD1OCQvWETUnB4BReUZr_joyRd1hH4AR0NipwTO8buReLKIgnVDh50/pubhtml?gid=1070525027&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
    </div>

    <div id="informational" class="subcontent">
      <h3>Prepositions</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSqeNceKSuzCMCNskX1XSyTA-GFN3Xcx8ye2GqGZLMF00duVSdJcLyCccxq-fQwxyHIS9NJMN9z3inD/pubhtml?gid=689662762&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>Questions V1</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSqeNceKSuzCMCNskX1XSyTA-GFN3Xcx8ye2GqGZLMF00duVSdJcLyCccxq-fQwxyHIS9NJMN9z3inD/pubhtml?gid=1707919888&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>Questions V2</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSqeNceKSuzCMCNskX1XSyTA-GFN3Xcx8ye2GqGZLMF00duVSdJcLyCccxq-fQwxyHIS9NJMN9z3inD/pubhtml?gid=985068758&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
    </div>

    <div id="navigational" class="subcontent">
      <h3>Navigational big brands</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSYVLKWv9BOHHqE-Lj4izr5ne3lzL58ZT8DFZl5P7ap4HeHmCFxkuZ2H4mfTkHOmrzCyWXg0aj8TU1d/pubhtml?gid=313868502&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
      <h3>Navigational medium competition</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSYVLKWv9BOHHqE-Lj4izr5ne3lzL58ZT8DFZl5P7ap4HeHmCFxkuZ2H4mfTkHOmrzCyWXg0aj8TU1d/pubhtml?gid=775491972&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
    </div>

    <div id="commercial" class="subcontent">
      <h3>Commercial Comparison</h3>
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRmWxvrBMzEzrBQKc6vCGwfEZvUdRm9JWVxex4xqzVt5kqI_vab5Egoqao3BgUsZNKWrvYyCRvtQKQE/pubhtml?widget=true&amp;headers=false"></iframe>
    </div>
  </div>

  <!-- Impact -->
  <div id="impact" class="content">
    <h2>SEO Impact Analysis</h2>
    <div class="impact-wrap gridish">
      <canvas id="seoChart"></canvas>
    </div>
  </div>

  <!-- Competitors -->
  <div id="competitors" class="content">
    <h2>Competitor Analysis</h2>
    <div class="subtabs">
      <div class="subtab active" data-sub="comp-stats">Competitor Stats</div>
      <div class="subtab" data-sub="comp-gap">Keyword Gap (Birme vs. Others)</div>
      <div class="subtab" data-sub="comp-insights">SEO Insights</div>
    </div>

    <div id="comp-stats" class="subcontent active">
      <section class="comp-card">
        <div class="chart-box"><canvas id="birme-traffic"></canvas></div>
      </section>
    </div>

    <div id="comp-gap" class="subcontent">
      <h3>Keyword Gap: Birme vs. other competitors</h3>
      <div class="gridish" style="overflow:auto; border-radius:12px; padding:8px;">
        <table id="gap-table" style="width:100%; border-collapse:collapse; color:#eaeaea; font-size:14px;">
          <thead id="gap-thead"></thead>
          <tbody id="gap-tbody"></tbody>
        </table>
      </div>
    </div>

    <div id="comp-insights" class="subcontent">
      <iframe class="doc-iframe" src="https://docs.google.com/document/d/e/2PACX-1vQLEn_2HV2T3-O7Xidzca6kmNh-XdQbt1oiS-cNM1WmeIu1niWpZRUr7gLRVwa0MG7H7XwayI2X58n6/pub?embedded=true"></iframe>
    </div>
  </div>

 <!-- ===== Analytics (UPDATED) ===== -->
<div id="analytics" class="content">
  <h2>Analytics</h2>

  <!-- Subtabs (new order) -->
  <div class="subtabs">
    <div class="subtab active" data-sub="ana-overview">Overview</div>
    <div class="subtab" data-sub="ana-retention">Retention</div>
    <div class="subtab" data-sub="ana-campaigns">Campaigns</div>
    <div class="subtab" data-sub="ana-stickiness">Stickiness</div>
    <div class="subtab" data-sub="ana-funnel">Funnel</div>
    <div class="subtab" data-sub="ana-reports">Reports</div>
    <div class="subtab" data-sub="ana-insights">Insights</div>
  </div>

  <!-- ===== Overview ===== -->
  <div id="ana-overview" class="subcontent active">
    <div class="tile-grid" id="ov-tiles"></div>
    <div class="chart-box" style="margin-top:16px;"><canvas id="ov-chart"></canvas></div>

    <h3 style="margin-top:22px;">Events: Event name (attached)</h3>
    <div id="ov-attachments"></div>
  </div>

  <!-- ===== Retention (Overall) ===== -->
  <div id="ana-retention" class="subcontent">
    <div class="tile-grid" id="ret-tiles"></div>
    <h3 style="margin-top:12px;">Overall Retention (Week 0–6)</h3>
    <div class="gridish" style="overflow:auto; border-radius:12px; padding:8px;">
      <table id="ret-table" style="width:100%; border-collapse:collapse; color:#eaeaea; font-size:14px;"></table>
    </div>

    <h3 style="margin-top:22px;">Overall Retention (attached report)</h3>
    <div id="ret-attachments"></div>
  </div>

  <!-- ===== Campaigns ===== -->
  <div id="ana-campaigns" class="subcontent">
    <div id="camp-tiles" class="tile-grid"></div>

    <h3 style="margin-top:12px;">Campaign Retention (Week 0–6)</h3>
    <div class="gridish" style="overflow:auto; border-radius:12px; padding:8px;">
      <table id="camp-ret-table" style="width:100%; border-collapse:collapse; color:#eaeaea; font-size:14px;"></table>
    </div>

    <h3 style="margin-top:22px;">Campaign Reports (attached)</h3>
    <div id="camp-attachments"></div>
  </div>

  <!-- ===== Stickiness ===== -->
  <div id="ana-stickiness" class="subcontent">
    <div class="tile-grid" id="stk-tiles"></div>
    <!-- No chart here by request -->
    <h3 style="margin-top:22px;">User Stickiness (attached)</h3>
    <div id="stk-attachments"></div>
  </div>

  <!-- ===== Funnel ===== -->
  <div id="ana-funnel" class="subcontent">
    <h3>User Funnel (attached)</h3>
    <div id="fun-attachments"></div>
  </div>

  <!-- ===== Reports gallery ===== -->
  <div id="ana-reports" class="subcontent">
    <h3>All Attached Reports</h3>
    <div id="rep-attachments"></div>
  </div>

  <!-- ===== Insights (placeholder) ===== -->
  <div id="ana-insights" class="subcontent">
    <div class="richtext">
      <p>We’ll capture commentary & next steps here once you finalise the latest numbers.</p>
    </div>
  </div>
</div>

  <!-- Next Steps -->
  <div id="nextsteps" class="content">
    <h2>Next Steps</h2>
    <div id="nextsteps-content">
      <ul style="list-style:disc; padding-left:1.25rem; color:var(--ink-2); line-height:1.6;">
        <li><strong style="color:var(--ink)">Blog:</strong> Keep cadence focused on informational & commercial queries; link to the tool + platform pages.</li>
        <li><strong style="color:var(--ink)">Dynamic CMS Pages:</strong> Platform + industry variants; cross-linking strategy.</li>
        <li><strong style="color:var(--ink)">Campaign tuning:</strong> Use campaign retention deltas to reallocate spend/geo.</li>
        <li><strong style="color:var(--ink)">App onboarding:</strong> Lift Redirect→Login via copy + technical hardening.</li>
      </ul>
    </div>
  </div>

  <script>
    // Deep clone helper
    function deepClone(obj){
      try { return typeof structuredClone==='function' ? structuredClone(obj) : JSON.parse(JSON.stringify(obj)); }
      catch(e){ return JSON.parse(JSON.stringify(obj)); }
    }

    /* Demo charts */
    Chart.defaults.color = '#d8d8de';
    Chart.defaults.borderColor = 'rgba(255,255,255,.08)';

    function makeChart(id, type, labels, data, colors, opts={}){
      const el = document.getElementById(id); if(!el) return;
      const options = {
        responsive:true, maintainAspectRatio:false,
        plugins:{ legend:{ display:(opts.legend!==undefined)?opts.legend:(type!=='bar') }, tooltip:{enabled:true} },
        scales:{}
      };
      if(type!=='pie' && type!=='doughnut'){
        options.scales = { x:{grid:{color:'rgba(255,255,255,.06)'}}, y:{grid:{color:'rgba(255,255,255,.06)'}} };
      }
      new Chart(el.getContext('2d'),{
        type, data:{ labels, datasets:[{ label:opts.label||'', data, backgroundColor:colors, borderColor:colors, tension:.32, fill:(type==='line')?false:true, pointRadius:(type==='line')?3:0 }] }, options
      });
    }

    // Example impact chart
    makeChart('seoChart','bar',['Meta Titles','Alt Text','Schema','Page Speed'],[8,7,9,6],['#0a84ff','#30d158','#ffd60a','#ff453a'],{legend:false});

    // Keyword Gap table
    const GAP_CSV = 'assets/Birme%20keyword%20gap.csv';
    function renderGapTable(rows, limit=1000){
      const thead = document.getElementById('gap-thead');
      const tbody = document.getElementById('gap-tbody');
      if(!thead||!tbody||!rows||!rows.length) return;
      const cols = Object.keys(rows[0]);
      thead.innerHTML = '<tr>' + cols.map(c=>`<th style="text-align:left;padding:8px;border-bottom:1px solid rgba(255,255,255,.08)">${c}</th>`).join('') + '</tr>';
      tbody.innerHTML = rows.slice(0,limit).map(r=>(
        '<tr>'+cols.map(c=>`<td style="padding:8px;border-bottom:1px solid rgba(255,255,255,.06)">${r[c]??''}</td>`).join('')+'</tr>'
      )).join('');
    }
    function loadKeywordGap(){
      if(!document.getElementById('gap-table')) return;
      if(typeof Papa==='undefined'){ console.warn('PapaParse not loaded'); return; }
      Papa.parse(GAP_CSV,{download:true,header:true,skipEmptyLines:true,complete:(res)=>renderGapTable(res.data)});
    }

    /***** Analytics wiring (reads assets/analytics-config.json) *****/
const CURRENT_ANALYTICS_FILE = 'assets/analytics-config.json';

const ANA_DEFAULT = {
  period: '',
  overview: { wix:{page_view:0, app_redirect:0}, app:{login:0, export_images:0} },
  campaigns: {
    global: { wix:{page_view:0, app_redirect:0}, app:{login:0, export_images:0}, retention_pct:[100,0,0,0,0,0,0] },
    europe: { wix:{page_view:0, app_redirect:0}, app:{login:0, export_images:0}, retention_pct:[100,0,0,0,0,0,0] }
  },
  retention_overall_pct:[100,0,0,0,0,0,0],
  stickiness:{dau:0, wau:0, mau:0},
  attachments:{
    overview:[], retention:[], campaigns:[], stickiness:[], funnel:[], reports:[]
  }
};

let ANA = structuredClone(ANA_DEFAULT);
function fmt(n){ return (n??0).toLocaleString(); }
function pct(n){ return (n*100).toFixed(1)+'%'; }
function pct100(n){ return (n).toFixed(1)+'%'; }  // value already 0–100
function ratio(num, den){ return (!den||!num)?0:(num/den); }

async function loadANA(){
  try{
    const r = await fetch(CURRENT_ANALYTICS_FILE, {cache:'no-store'});
    if(!r.ok) throw 0;
    ANA = await r.json();
  }catch(e){
    console.warn('Using ANA_DEFAULT (config not found).');
    ANA = structuredClone(ANA_DEFAULT);
  }
}

/* ---------- Render helpers ---------- */
function makeTile(label, value, sub=''){
  return `<div class="tile">
    <div class="label">${label}</div>
    <div class="value">${value}</div>
    ${sub?`<div class="sub">${sub}</div>`:''}
  </div>`;
}
function renderIframes(mountId, paths=[]){
  const mount = document.getElementById(mountId);
  if(!mount) return;
  if(!paths || !paths.length){
    mount.innerHTML = `<p class="richtext">No attachments.</p>`;
    return;
  }
  mount.innerHTML = paths.map(p=>{
    const isPDF = /\.pdf(?:$|\?)/i.test(p);
    return `<iframe ${isPDF ? 'class="doc-iframe"' : ''} src="${p}"></iframe>`;
  }).join('');
}
/* ---------- Overview ---------- */
function renderOverview(){
  const o = ANA.overview || {};
  const pv = o.wix?.page_view||0, ar=o.wix?.app_redirect||0, lg=o.app?.login||0, rz=o.app?.export_images||0;

  const tiles = [
    makeTile('CTA click-through (Wix → App)', pct(ratio(ar,pv)), `${fmt(ar)} / ${fmt(pv)} users`),
    makeTile('Redirect → Login',               pct(ratio(lg,ar)),  `${fmt(lg)} / ${fmt(ar)} users`),
    makeTile('Login → Resize (init.)',         pct(ratio(rz,lg)),  `${fmt(rz)} / ${fmt(lg)} users`),
    makeTile('Page → Resize (overall)',        pct(ratio(rz,pv)),  `${fmt(rz)} / ${fmt(pv)} users`)
  ];
  document.getElementById('ov-tiles').innerHTML = tiles.join('');

  // Simple bar of just the 4 ratios (keep this chart)
  const labels = ['CTA','Redirect→Login','Login→Resize','Page→Resize'];
  const data = [
    ratio(ar,pv)*100, ratio(lg,ar)*100, ratio(rz,lg)*100, ratio(rz,pv)*100
  ];
  makeChart('ov-chart','bar',labels,data,['#0a84ff','#30d158','#ffd60a','#7a7aff'],{legend:false,titleInside:{text:ANA.period,align:'topleft'}});

  renderIframes('ov-attachments', ANA.attachments?.overview||[]);
}

/* ---------- Retention (Overall) ---------- */
function renderRetention(){
  const arr = ANA.retention_overall_pct || [100,0,0,0,0,0,0];
  const [w0,w1,w2,w3,w4,w5,w6] = arr;

  const tiles = [
    makeTile('Week-1 Returners', fmt(Math.round(w1)), 'Users returning in week 1'),
    makeTile('Week-2 Returners', fmt(Math.round(w2)), 'Users returning in week 2'),
    makeTile('Week-3 Returners', fmt(Math.round(w3)), 'Users returning in week 3')
  ];
  document.getElementById('ret-tiles').innerHTML = tiles.join('');

  const t = document.getElementById('ret-table');
  const hdr = ['Week 0','Week 1','Week 2','Week 3','Week 4','Week 5','Week 6'];
  const row = arr.map(v=>`<td style="padding:10px;border-bottom:1px solid rgba(255,255,255,.06)">${pct100(v)}</td>`).join('');
  t.innerHTML = `<thead><tr>${hdr.map(h=>`<th style="text-align:left;padding:10px;border-bottom:1px solid rgba(255,255,255,.08)">${h}</th>`).join('')}</tr></thead>
                 <tbody><tr>${row}</tr></tbody>`;

  renderIframes('ret-attachments', ANA.attachments?.retention||[]);
}

/* ---------- Campaigns ---------- */
function renderCampaigns(){
  const g = ANA.campaigns?.global || {}, e = ANA.campaigns?.europe || {};
  const tiles = [];

  function ratios(c, label){
    const pv=c.wix?.page_view||0, ar=c.wix?.app_redirect||0, lg=c.app?.login||0, rz=c.app?.export_images||0;
    return [
      makeTile(`${label}: CTA`,              pct(ratio(ar,pv)), `${fmt(ar)} / ${fmt(pv)} users`),
      makeTile(`${label}: Redirect→Login`,   pct(ratio(lg,ar)), `${fmt(lg)} / ${fmt(ar)} users`),
      makeTile(`${label}: Login→Resize`,     pct(ratio(rz,lg)), `${fmt(rz)} / ${fmt(lg)} users`),
      makeTile(`${label}: Page→Resize`,      pct(ratio(rz,pv)), `${fmt(rz)} / ${fmt(pv)} users`)
    ];
  }
  tiles.push(...ratios(g,'Global'), ...ratios(e,'Europe'));
  document.getElementById('camp-tiles').innerHTML = tiles.join('');

  // retention mini-table: two rows (Global, Europe), week0..6
  const hdr = ['Campaign','W0','W1','W2','W3','W4','W5','W6'];
  const gr = (g.retention_pct||[100,0,0,0,0,0,0]).map(v=>pct100(v));
  const er = (e.retention_pct||[100,0,0,0,0,0,0]).map(v=>pct100(v));
  const campT = document.getElementById('camp-ret-table');
  campT.innerHTML =
    `<thead><tr>${hdr.map(h=>`<th style="text-align:left;padding:10px;border-bottom:1px solid rgba(255,255,255,.08)">${h}</th>`).join('')}</tr></thead>
     <tbody>
       <tr><td style="padding:10px;border-bottom:1px solid rgba(255,255,255,.06)">Global</td>${gr.map(v=>`<td style="padding:10px;border-bottom:1px solid rgba(255,255,255,.06)">${v}</td>`).join('')}</tr>
       <tr><td style="padding:10px;border-bottom:1px solid rgba(255,255,255,.06)">Europe</td>${er.map(v=>`<td style="padding:10px;border-bottom:1px solid rgba(255,255,255,.06)">${v}</td>`).join('')}</tr>
     </tbody>`;

  renderIframes('camp-attachments', ANA.attachments?.campaigns||[]);
}

/* ---------- Stickiness ---------- */
    function renderStickiness(){
  const s = ANA.stickiness_pct; // use the pct block if you choose this model
  if(!s){ document.getElementById('stk-tiles').innerHTML = ''; return; }

  const tiles = [];
  const regions = ['global','europe'].filter(k => s[k]);
  for(const k of regions){
    tiles.push(
      makeTile(`${k[0].toUpperCase()+k.slice(1)}: DAU / WAU`, (s[k].dau_wau??0).toFixed(1)+'%'),
      makeTile(`${k[0].toUpperCase()+k.slice(1)}: WAU / MAU`, (s[k].wau_mau??0).toFixed(1)+'%'),
      makeTile(`${k[0].toUpperCase()+k.slice(1)}: DAU / MAU`, (s[k].dau_mau??0).toFixed(1)+'%')
    );
  }
  document.getElementById('stk-tiles').innerHTML = tiles.join('');
  renderIframes('stk-attachments', ANA.attachments?.stickiness||[]);
}


/* ---------- Funnel & Reports ---------- */
function renderFunnel(){ renderIframes('fun-attachments', ANA.attachments?.funnel||[]); }
function renderReports(){ renderIframes('rep-attachments', ANA.attachments?.reports||[]); }

/* ---------- Mount when the Analytics tab opens ---------- */
async function initAnalytics(){
  await loadANA();
  renderOverview();
  renderRetention();
  renderCampaigns();
  renderStickiness();
  renderFunnel();
  renderReports();
}
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.tab').forEach(tab=>{
    tab.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');

      // ✅ Only this for Analytics
      if(tab.dataset.tab==='analytics'){
        initAnalytics();
      }
    });
  });

  // Subtabs (keep just this one)
  document.querySelectorAll('.subtab').forEach(sub=>{
    sub.addEventListener('click',()=>{
      const wrap = sub.closest('.content'); if(!wrap) return;
      wrap.querySelectorAll('.subtab').forEach(s=>s.classList.remove('active'));
      wrap.querySelectorAll('.subcontent').forEach(sc=>sc.classList.remove('active'));
      sub.classList.add('active');
      const target = document.getElementById(sub.dataset.sub); if(target) target.classList.add('active');

      if(sub.dataset.sub==='comp-gap') loadKeywordGap();
    });
  });
});

    // Small demo chart so Competitor tab isn’t empty
    makeChart('birme-traffic','line',['Feb','Mar','Apr','May','Jun','Jul','Aug'],[13787,14607,13907,14553,13090,19484,15760],['#0a84ff'],{label:'Organic Traffic'});
  </script>
</body>
</html>

